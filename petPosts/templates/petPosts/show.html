{% extends 'base.html' %}

{% load static %}

{% block content %}
<div>
  <a href="{% url 'petPosts:index' %}">home</a>
  <h1 id="post-title" data-post-id="{{ post.id }}">{{ post.title }}</h1>
  <p>작성일: {{ post.created_at }}</p>
  {% for photo in post.photo_set.all%}
    <img src="{{photo.image.url}}" width="50"><br>
  {% endfor %}
  <p style="width: 70%;">{{ post.content }}</p>
  {% if request.user == post.pet.owner%}
  <a href="{% url 'petPosts:update' id=post.id %}">수정</a>
  <a href="{% url 'petPosts:delete' id=post.id %}">삭제</a>
  {% endif %}
  {% if user.is_authenticated %}
  <a id="show-{{post.id}}-like-button" onclick="onLikePost({{post.id}})">
    {{ post.like_users.count }} Likes
  </a>
  {% endif %}
  <p id="comment-count"><strong>댓글이 {{ post.comment_set.count }}개 있습니다 </strong>
  <p>
  {% csrf_token %}
  <input id="post{{post.id}}-comment-input" type="text" name="content" />
  <button onclick="onAddComment({{post.id}})">댓글 달기</button>
  <div id="{{post.id}}-comment-list">
    {% for comment in post.comment_set.all|dictsortreversed:"like_users.count" %}
      <p id="post{{post.id}}-comment{{comment.id}}">
        {{ comment.author }}: {{ comment.content }} &nbsp; &nbsp;{{ comment.created_at|date:'Y년 M d일 H:m'}}
        {% if user.is_authenticated %}
          <a id="comment{{comment.id}}-like-button" onclick="onLikeComment({{comment.id}})">
            {{ comment.like_users.count }} Likes
          </a>
        {% endif %}
        {% if request.user == comment.author %}
          <a onclick="onDeleteComment({{post.id}}, {{comment.id}})">댓글 삭제</a>
        {% endif %}
      </p>
    {% endfor %}
  </div>
</div>
{% endblock content %}
