{% extends 'base.html' %}

{% load sass_tags %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% sass_src 'petPosts/scss/show.scss' %}">
{% endblock style %}
{% load static %}
{% block js %}
<script type="module" src="{% static 'petPosts/js/show.js' %}"></script>
{% endblock js %}
{% block content %}
<script language="JavaScript" type="text/javascript" src="{% static 'petPosts/js/show2.js' %}"></script>
<div>
 <a href="{% url 'petPosts:index' %}">home<svg class="u-svg-content-2" viewBox="0 -32 426.66667 426" style="width: 1em; height: 1em;"><path d="m213.332031 181.667969c0 4.265625-1.277343 8.53125-3.625 11.730469l-106.667969 160c-3.839843 5.761718-10.238281 9.601562-17.707031 9.601562h-64c-11.730469 0-21.332031-9.601562-21.332031-21.332031 0-4.269531 1.28125-8.535157 3.625-11.734375l98.773438-148.265625-98.773438-148.269531c-2.34375-3.199219-3.625-7.464844-3.625-11.730469 0-11.734375 9.601562-21.335938 21.332031-21.335938h64c7.46875 0 13.867188 3.839844 17.707031 9.601563l106.667969 160c2.347657 3.199218 3.625 7.464844 3.625 11.734375zm0 0"></path><path d="m426.667969 181.667969c0 4.265625-1.28125 8.53125-3.628907 11.730469l-106.664062 160c-3.839844 5.761718-10.242188 9.601562-17.707031 9.601562h-64c-11.734375 0-21.335938-9.601562-21.335938-21.332031 0-4.269531 1.28125-8.535157 3.628907-11.734375l98.773437-148.265625-98.773437-148.269531c-2.347657-3.199219-3.628907-7.464844-3.628907-11.730469 0-11.734375 9.601563-21.335938 21.335938-21.335938h64c7.464843 0 13.867187 3.839844 17.707031 9.601563l106.664062 160c2.347657 3.199218 3.628907 7.464844 3.628907 11.734375zm0 0"></path></svg><img></a>
  <a href="{% url 'pets:showpet' id=post.pet.id %}">펫 페이지로 돌아가기</a>
  <h1 id="post-title" data-post-id="{{ post.id }}">{{ post.title }}</h1>
  <p>{{post.pet.name}}의 포스트</p>
  <h1 id="post-title" data-post-id="{{ post.id }}">{{ post.title }}</h1>
  
  <p>작성일: {{ post.created_at }}</p>
  {% for photo in post.photo_set.all%}
    <img src="{{photo.image.url}}" width="500"><br>
  {% endfor %}
  <p style="width: 70%;">{{ post.content }}</p>
  {% if post.pet.owner == request.user.profile %}
  <a href="{% url 'petPosts:update' id=post.id %}">수정</a>
  <a id="post-delete" onclick="onDeletePost({{post.id}}, {{post.pet.id}})">삭제</a>
  {% endif %}
        <div class="like-container">
        {% if user.is_authenticated %}
        <a class="material-icons mdl-badge mdl-badge--overlap"
          data-badge="{{ post.like_users.count }}"
          onclick="onClickLikeButton({{post.id}})"
          id="{{post.id}}-like-button"
        >
          {% if user in post.like_users.all %}
          favorite
          {% else %}
          favorite_border
          {% endif %}
        </a>
        {% else %}
        <div class="material-icons mdl-badge mdl-badge--overlap" 
          data-badge="{{ post.like_users.count }}">
          favorite
        </div>
        {% endif %}
      </div>
  <p id="comment-count"><strong>댓글이 {{ post.comment_set.count }}개 있습니다 </strong>
  <p>
  {% csrf_token %}
  <input id="post{{post.id}}-comment-input" type="text" name="content" />
  <button onclick="onAddComment({{post.id}})">댓글 달기</button>
  <div id="{{post.id}}-comment-list">
    {% for comment in post.comment_set.all|dictsortreversed:"like_users.count" %}
      <p id="post{{post.id}}-comment{{comment.id}}">
        {{ comment.author }}: {{ comment.content }} &nbsp; &nbsp;{{ comment.created_at|date:'Y년 M d일 H:m'}}
        {% if user.is_authenticated %}
          <a id="comment{{comment.id}}-like-button" onclick="onLikeComment({{comment.id}})">
            {{ comment.like_users.count }} Likes
          </a>
        {% endif %}
        {% if request.user == comment.author %}
          <a onclick="onDeleteComment({{post.id}}, {{comment.id}})">댓글 삭제</a>
        {% endif %}
      </p>
    {% endfor %}
  </div>
</div>
{% endblock content %}
